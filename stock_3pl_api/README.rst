=============
Stock 3PL Api
=============

.. !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   !! This file is generated by oca-gen-addon-readme !!
   !! changes will be overwritten.                   !!
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

.. |badge1| image:: https://img.shields.io/badge/maturity-Beta-yellow.png
    :target: https://odoo-community.org/page/development-status
    :alt: Beta
.. |badge2| image:: https://img.shields.io/badge/licence-AGPL--3-blue.png
    :target: http://www.gnu.org/licenses/agpl-3.0-standalone.html
    :alt: License: AGPL-3
.. |badge3| image:: https://img.shields.io/badge/github-OCA%2Fstock--logistics--workflow-lightgray.png?logo=github
    :target: https://github.com/OCA/stock-logistics-workflow/tree/12.0/stock_3pl_api
    :alt: OCA/stock-logistics-workflow
.. |badge4| image:: https://img.shields.io/badge/weblate-Translate%20me-F47D42.png
    :target: https://translation.odoo-community.org/projects/stock-logistics-workflow-12-0/stock-logistics-workflow-12-0-stock_3pl_api
    :alt: Translate me on Weblate
.. |badge5| image:: https://img.shields.io/badge/runbot-Try%20me-875A7B.png
    :target: https://runbot.odoo-community.org/runbot/154/12.0
    :alt: Try me on Runbot

|badge1| |badge2| |badge3| |badge4| |badge5| 

Introduction
~~~~~~~~~~~~

Third-party logistics (abbreviated as 3PL, or TPL) in logistics and supply chain management
is an organization's use of third-party businesses to outsource elements of its distribution,
warehousing, and fulfillment services. (Wikipedia)

This module exposes the convenient Odoo stock operations to a 3PL partner with a
**REST API**.
It means the 3PL partner should implement a **REST API client** in order to get Odoo
reflect the stock operations he does physically.
The OCA/wms/shopfloor module has been a source of inspiration. However this
module is simpler as it focuses on higher level operations compared to Shopfloor.

The service uses an **API key** in the HTTP header to authenticate the API user.
An API key is created in the Demo data (for development), using the Demo user.
This demo key to use in the HTTP header API-KEY is: 42D144F7BE780EBD

The API key is associated to an Odoo user and its permissions. You may take
advantage of this in the case of a multi-company set up.

The API exposes 1 main endpoint for consulting the catalog and the inventory:

* GET /stock-3pl-api/product

and 4 main endpoints for consulting the pickings and processing them:

* GET /stock-3pl-api/picking
* GET /stock-3pl-api/picking/<id>
* POST /stock-3pl-api/picking/<id>/done
* POST /stock-3pl-api/picking/<id>/update

The usage of these endpoints is explained in the following sections.

**Table of contents**

.. contents::
   :local:

Usage
=====

Catalog and Inventory
~~~~~~~~~~~~~~~~~~~~~

First the 3PL partner can import the catalog and inventory from Odoo with the

Product list endpoint::
  GET /stock-3pl-api/product

Curl example::
  curl -H "API-KEY: 42D144F7BE780EBD"  http://localhost:8069/stock-3pl-api/product

The 3PL partner can typically use this to ensure that the Odoo stock levels
are consistent with its own inventory and warn you otherwise.

TODO what about an API point to warn Odoo about a stock level error?

You can also consult a specific product with its id::
  GET /stock-3pl-api/product/<id>

Curl example::
  curl -H "API-KEY: 42D144F7BE780EBD"  http://localhost:8069/stock-3pl-api/product/10

You can also specify a specific stock_location_name to get the stock levels at
a specific location in case you have a more sophisticated multi-locations usage.
TODO document.


Purchase Orders / Incoming Pickings
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

This module is mostly used to manage your product expeditions. But the 3PL partner
might also inform Odoo about the received products.
Reception works a bit the same as expedition but in fact it is simpler, so let's start talking
about the product reception API (or purchase orders).

The validation of an Odoo purchase orders in Odoo will create an incoming stock.picking
that we can import with the 3PL API:


Getting the list of receptions
==============================

picking list endpoint::
  GET /picking

Curl example::
  curl -v -H "API-KEY: 42D144F7BE780EBD" "http://localhost:8069/stock-3pl-api/picking?picking_type_name=Receipts&states=confirmed|assigned"


stock.picking filters
=====================

You can filter these incoming pickings using the following parameters:

* picking_type_name: use 'Receipts' for reception but in fact you could manage any Odoo picking operation
* states: a string with the value of the Odoo state picking field, or a list of values separated with |
* date_from
* date_to
* id_3pl: use false to filter only the stock pickings with no id_3pl yet. Eventually you will later write an id_3pl in some pickings to help you filter

You can also consult a specific picking with::
  GET /stock-3pl-api/picking/<id>


Processing a stock.picking
==========================

When the products are received, you can simply set the picking to the 'done'
state with all the planed quantities with the:

set to done picking endpoint::
  POST /stock-3pl-api/picking/<id>/done?force_reserved_quantities=true

If you don't specify force_reserved_quantities=true, only the reserved quantities
will be processed, see later how you can inform these reserved quantities with
the API.

Curl example::
  curl -X POST -H "API-KEY: 42D144F7BE780EBD" http://localhost:8069/stock-3pl-api/picking/9/done?force_reserved_quantities=true

You can ensure in the response that the picking state is 'done'.


But instead you might likely want to inform the processed quantities and eventually
leave a back order to process later.
For this you should first consult the id of the planed stock.move of the picking
in order to inform the done quantity for each move. The field with the list of
planed moves is called 'move_ids_without_package'.

You can consult these move ids either from the picking list either with:

The picking detail endpoint::
  GET /stock-3pl-api/picking/<id>

So suppose you you have a single move an id 36 and with a planed move quantity of 35.
If you want to inform you processed only 30 products, you can use:

set to done picking endpoint with detailed quantities::
  POST /stock-3pl-api/picking/<id>/done --data '{"moves":[{"id":<move_id>, "quantity_done": <move_qty>}, ...]}'

Curl example::
  curl -X POST -v -H "API-KEY: 42D144F7BE780EBD"  --header "Content-Type: application/json" --data '{"moves":[{"id":36, "quantity_done": 30}]}' "http://localhost:8069/stock-3pl-api/picking/26/done"

See the API specification detail in Swagger or Postman for all the options.

With such a command you will leave a backorder open for later reception,
after setting the picking to done, you will get the list of open backorder ids
in the **backorder_ids** response parameter.

If instead you don't want to leave any open backorder, you can pass the
cancel_backorder=true parameter. In this case you may still have a backorder
after processing a picking, but its state will be "cancel" so it won't be
active.

Updating reserved quantity or other picking information without actually
processing the picking can be achieved using the update endpoint that
accepts similar parameters as the the done endpoint.

update endpoint::
  POST /stock-3pl-api/picking/<id>/update

Curl example::
  curl -X POST -v -H "API-KEY: 42D144F7BE780EBD"  --header "Content-Type: application/json" --data '{"moves":[{"id":31, "quantity_done": 30}]}' "http://localhost:8069/stock-3pl-api/picking/21/update"

See the API specification detail for all the options.
You can then use the "/POST done" endpoint to process the picking in this case
you don't need to repeat the moves details when setting the picking to done.


Sale Orders / Outgoing Pickings
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Managing the product expeditions is very similar to managing the product reception
as explained in the previous section, except it is more complex because of
the packages and tracking information.

the validation of sale orders in Odoo will create outgoing stock.picking that
we can import in 3PL using the **GET /picking endpoint**.

Curl example::
  curl -v -H "API-KEY: 42D144F7BE780EBD" "http://localhost:8069/stock-3pl-api/picking?picking_type_name=Delivery&states=assigned"

**filters**: you can use the same filters as for the incoming pickings described
in the previous section. Notice that for delivery we use **picking_type_name=Delivery**.
If you filter using states=assigned you will get only deliveries with enough stock
to be processed. Instead you can use states=confirmed|assigned if you want also
the confirmed pickings with not enough stock.

Another filter you may want to use is **id_3pl=false** to get only the new
deliveries for which you have not assigned any id_3pl yet.

You can simply process the delivery pickings with the **/done and /update endpoints**
just like for incoming pickings.


Packaging and tracking information
==================================

But one important thing you can do is set packages and tracking information
if you need.

To do this you should not simply pass the quantity done for each picking move,
but you should instead detail for each move, the list of packages,
with the package ref, quantity, weight and tracking_url eventually.

For instance::
curl -X POST -H "API_KEY: 42D144F7BE780EBD" --header "Content-Type: application/json" \
--data '{"moves":[{"id":11, "lines":[{"quantity": 5, "package": {"ref": "box1"}}, {"quantity": 10, "package": {"ref": "box2"}}]}]}' \
"http://localhost:8069/stock-3pl-api/picking/1/done"

TODO picture links


And also you can use /update endpoint instead to update the picking detail without
actually processing it yet. And you can process it later using /done.
See the API specification for the details.

backorders are handled the same way as for incoming pickings.

Bug Tracker
===========

Bugs are tracked on `GitHub Issues <https://github.com/OCA/stock-logistics-workflow/issues>`_.
In case of trouble, please check there if your issue has already been reported.
If you spotted it first, help us smashing it by providing a detailed and welcomed
`feedback <https://github.com/OCA/stock-logistics-workflow/issues/new?body=module:%20stock_3pl_api%0Aversion:%2012.0%0A%0A**Steps%20to%20reproduce**%0A-%20...%0A%0A**Current%20behavior**%0A%0A**Expected%20behavior**>`_.

Do not contact contributors directly about support or help with technical issues.

Credits
=======

Authors
~~~~~~~

* Akretion

Contributors
~~~~~~~~~~~~

* Raphaël Valyi <raphael.valyi@akretion.com.br>

Maintainers
~~~~~~~~~~~

This module is maintained by the OCA.

.. image:: https://odoo-community.org/logo.png
   :alt: Odoo Community Association
   :target: https://odoo-community.org

OCA, or the Odoo Community Association, is a nonprofit organization whose
mission is to support the collaborative development of Odoo features and
promote its widespread use.

.. |maintainer-rvalyi| image:: https://github.com/rvalyi.png?size=40px
    :target: https://github.com/rvalyi
    :alt: rvalyi

Current `maintainer <https://odoo-community.org/page/maintainer-role>`__:

|maintainer-rvalyi| 

This module is part of the `OCA/stock-logistics-workflow <https://github.com/OCA/stock-logistics-workflow/tree/12.0/stock_3pl_api>`_ project on GitHub.

You are welcome to contribute. To learn how please visit https://odoo-community.org/page/Contribute.
